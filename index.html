
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="description"
    content="Bark Blockly Editor is a mod of Blockly. Many things are still in devolopment such as project saving, file readers, and costume and sound libraries." />
  <title>Bark Blockly Editor</title>
  <meta name="title" content="Bark coding - Editor">
  <meta name="description" content="Bark is a programming language building off of Google's Blockly.">
  <link rel="shortcut icon" href="https://bark.dumorando.com/favicon.ico" type="image/png">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://bark.dumorando.com/">
  <meta property="og:title" content="Bark coding - Editor">
  <meta property="og:description" content="Bark is a programming language building off of Google's Blockly.">
  <meta property="og:image" content="/src/images/Logo.svg">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://bark.dumorando.com/">
  <meta property="twitter:title" content="Bark coding - Editor">
  <meta property="twitter:description" content="Bark is a programming language building off of Google's Blockly.">
  <meta property="twitter:image" content="/src/images/Logo.svg">
  
  <!-- Optional Meta Tags -->
  <meta name="keywords" content="coding, blockly, block coding, bark coding">
  <meta name="robots" content="index, follow">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="language" content="English">
  <meta name="revisit-after" content=" days">
  <meta name="author" content="mariocraft">
  <link rel="shortcut icon" href="/favicon.ico">
  <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@blockly/theme-dark"></script>
  <script src="/scripts/p5.min.js"></script>
  <script src="/scripts/sketch.js"></script>

  <script src="/scripts/custom_category_es6.js"></script>
  <script src="/scripts/toolbox_label_e26.js"></script>
  <link rel="stylesheet" lang="css" href="/scripts/uploader.css">
  <style>
    @import url(https://fonts.googleapis.com/css?family=Montserrat);

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      background-color: #fff;
    }

    .blocklyToolboxContents {
      flex-wrap: nowrap !important;
    }

    .navbar {
      overflow: hidden;
      height: 45px!important;
    }

    .tabpage {
      display: none;
      height: calc(100% - 80px);
      width: calc(100% - 640px);
      position: absolute;
      bottom: 0;
    }

    body.code #blocklyDiv {
      display: block;
    }

    body.costumes #costumeseditordiv {
      display: block;
      padding: 7px;
    }

    body.sounds #soundseditordiv {
      display: block;
      padding: 7px;
    }

    body.extensions #extensioneditordiv {
      display: block;
      padding: 7px;
    }

    body.moreextension #moreextensionseditordiv {
      display: block;
      padding: 7px;
    }

    #blocklyDiv * {
      transition: 0s;
    }

    #stage {
      height: 360px;
      width: 640px;
      outline: 1px solid #ccc;
      box-sizing: border-box;
      border-radius: 5px;
      position: absolute;
      right: 0px;
      transition: 0s;
      background-color: #ffffff;
    }

    .stage-left #stage {
      left: 0px;
    }

    #generated-code {
      height: calc(100% - 40px);
      /* Adjusted height to accommodate navbar */
      width: 25%;
      background-color: #f4f4f4;
      padding: 10px;
      overflow-y: auto;
      font-family: monospace;
      white-space: pre-wrap;
      display: block;
      /* Initially visible */
    }

    .hidden {
      display: none;
      /* Hide the generated code area */
    }
    .blocklyToolboxDiv {
      padding: 0px;
      overflow-y: hidden;
    }

    .blocklyToolboxDiv[layout="h"] .blocklyToolboxCategory {
      height: inherit;
      cursor: pointer;
      margin: 3px;
    }

    .blocklyTreeLabel {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      color: #fff;
      padding: 13px;
    }

    .blocklyTreeLabelContrast {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      color: #000;
      padding: 13px;
    }

    .blocklyTreeRowContentContainer img {
      display: none;
    }

    .stage-left #blocklyDiv {
      position: absolute;
      right: 0px;
    }

    #editortabs {
      position: absolute;
      height: 35px;
    }

    #editortabs button {
      font-family: inherit;
      background-color: inherit;
      color: inherit;
      border: none;
      height: 15px;
      font-size: 15px;
      padding: 10px;
      cursor: pointer;
    }

    .extension {
      cursor: pointer;
    }

  .gallery {
    margin: 5px;
    width: 180px;
    cursor: pointer; 
    background-color: #c9deff; 
    border-radius: 25px; 
    width: 17; 
    height: 40
  }

  .desc {
    padding: 15px;
    text-align: center;
  }

  .gallery img { 
    text-align: center;
  }

  .projectToolbarButton:hover {
    box-shadow: 0 8px 7px rgba(0, 0, 0, 0.1);
  }

  #projectPlayer {
    width: 640px !important;
  }

  .popupholder {
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100vh;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 2000;
    justify-content: center;
    align-items: center;
    display: none;
  }

  .popupholder.active {
    display: flex;
  }

  .popup {
    color: white;
    padding: 20px;
    border-radius: 12px;
    border: 2px solid white;
    background-color: #333;
  }

span.extensionbox {
  display: inline-block;
}

.extensionbox {
    background-color: #fff;
    border: 2px solid #000;
    padding: 7px;
    margin: 5px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    width: 400px;
    text-align: center;
    cursor: pointer;
    width: 30px;
}

.extensionbox.h2 {
    margin-top: 0;
    color: #333;
}

.extensionbox.p {
    margin: 5px 0;
    color: #666;
}

  .extensionbox:hover {
    box-shadow: 0 8px 8px rgba(0, 0, 0, 0.1);
  }

  </style>
</head>

<body onload="setTimeout(start, 50);" class="code">
  <div class="navbar">
    <a href="/"><img src="https://bark.dumorando.com/src/images/Logo.svg" alt="Bark"
        width="25" height="25"></a>
    
    <input type="file" id="fileInput" accept=".barkf" style="display: none;" onchange="loadWorkspaceFromFile(this.files[0])" />
    <a href="#" onclick="openFileInput();" title="open a saved project">Open</a>

    <a href="#" id="downloadbutton" onclick="downloadproject();" title="download project to your computer.">Download</a>
    
    <a href="https://bark.dumorando.com/advanced">Advanced</a>
    
    <a class="dark-mode-button" id="darkModeToggle">
      
      <dmbico alt="Dark Mode"></dmbico>
    </a>

    <input class="searchBar" id="projectname" placeholder="Project name..." onchange="change_document_title()" value="project"></input>

    <a href="https://github.com/mariocraft987/bark-editor">Source</a>

  </div>
  
  <!-- Code Tab -->
  <div id="blocklyDiv" class="tabpage"></div>
  
  <!-- Costumes Tab -->
  <div id="costumeseditordiv" class="tabpage">
    <h1>Upload costume</h1>
    <input type='file' accept='image/*' id="fileupload" onchange='openFile(event)'><br>
    <img id='costume' style="width:70px;" src="https://bark.dumorando.com/src/images/dog/idle.svg">
    
  <!-- Place Image library here -->
    
  </div>
  
  <!-- Sounds Tab -->
  <div id="soundseditordiv" class="tabpage">
    <h1>Upload sound</h1>
    <input type="file" id="upload" accept="audio/*" onchange="openAudioFile(event);">
    <br />
    <div id="audiofilelist"></div>
  </div>

  <!-- More extensions Tab -->
  <div id="moreextensionseditordiv" class="tabpage">
    <h1>More extensions</h1>
    <p>Under dev now, im kinda lazy to do it yet</p>
  </div>

  <div class="popupholder">
    <div id="extensionseditordiv" class="popup">
      <h1>Choose An Extension</h1>
      <img src="https://bark.dumorando.com//src/images/assets/extension/sine.png" alt="Sine Extension"
        title="Sine (created by nmsderp)" class="extension" width="160" id="hardcodedSineExtension" data-extensionpath="/editor/builtinextensions/sine.js">
      <img src="https://bark.dumorando.com//src/images/assets/extension/ai.png" alt="Artificial Intelligence Extension"
        title="AI (created by funtasmo)" class="extension" width="160" id="hardcodedAIExtension" data-extensionpath="/editor/builtinextensions/ai.js">
      <h3>Or Upload a Extension to use.</h3>
      <input type="file" accept='.js' id="upload">
      <button class="buttonFrBx" onclick="document.querySelector('.popupholder').classList.remove('active')">Close menu..</button>
  
    </div>
  </div>
  <div id="editortabs">
    <button
      onclick="document.body.classList.add('code'); document.body.classList.remove('costumes'); document.body.classList.remove('sounds'); document.body.classList.remove('moreextension'); window.workspace.updateToolbox(toolbox);">Code</button>
    <button
      onclick="document.body.classList.remove('code'); document.body.classList.add('costumes'); document.body.classList.remove('sounds'); document.body.classList.remove('moreextension');">Costumes</button>
    <button
      onclick="document.body.classList.remove('code'); document.body.classList.remove('costumes'); document.body.classList.add('sounds'); document.body.classList.remove('moreextension');">Sounds</button>
    <button
      onclick="document.body.classList.remove('code'); document.body.classList.remove('costumes'); document.body.classList.remove('sounds'); document.body.classList.add('moreextension');">Extensions</button>
  </div>
  <div id="projectPlayer">
    <div id="projectToolbar">
      <img class="projectToolbarButton" style="cursor:pointer;" title="Run"
        src="https://bark.dumorando.com/src/projecttoolbar/run.svg" width="10" onclick="kill(); run_code();">
      
      <img class="projectToolbarButton" style="cursor:pointer;" title="Pause"
        src="https://bark.dumorando.com/src/projecttoolbar/pause.svg">
      
      <img class="projectToolbarButton" style="cursor:pointer;" title="Stop"
        src="https://bark.dumorando.com/src/projecttoolbar/stopped.svg" onclick="kill();">
      
      <img class="projectToolbarButton" src="https://bark.dumorando.com/src/projecttoolbar/maximize.svg" title="Fullscreen"
        onclick="NewtoggleFullscreen();" style="position: absolute; right: 0; cursor: pointer;">
    </div>
    <div id="stage-container"><div id="stage"></div></div>
  </div>
  <div id="sprites" style="position: absolute; right: 0%; bottom: 0%; width: 640px; height: calc(100% - 440px);">

    <span id="xysize">
  <label for="xpos">X pos:</label>
  <input value="0" type="number" id="xpos" name="xpos" min="-250" max="250" onchange="x = Number(document.getElementById('xpos').value) + 270;">
  <br />
  <br />
  <label for="ypos">Y pos:</label>
  <input value="0" type="number" id="ypos" name="ypos" min="-140" max="190" onchange="y = Number(document.getElementById('ypos').value) + 130;">
  <br />
  <br />
  <label for="spritesize">Size:</label>
  <input value="100" type="number" id="spritesize" name="spritesize" min="0" max="300" onchange="setsize(Number(document.getElementById('spritesize').value))">
  <p>Lorem Ipsum Dolor Sit Amit</p>
<!--
  <br/>
  <br/>
  <button class="buttonFrBx" onclick="contrastBlocks(Number(localStorage.contrast) + 1)">High Contrast</button>
-->
    </span>

    <!-- Toolbox Definition -->
    <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
      <category name="Logic" colour="#cf9100">
        <block type="onstart"></block>
        <block type="controls_if"></block>
        <block type="logic_compare">
          <field name="OP">EQ</field>
        </block>
        <block type="logic_operation">
          <field name="OP">AND</field>
        </block>
        <block type="logic_negate"></block>
        <block type="logic_keypressed"></block>
        <block type="logic_boolean">
          <field name="BOOL">TRUE</field>
        </block>
        <block type="logic_null"></block>
        <block type="logic_ternary"></block>
        <block type="logic_this"></block>
      </category>
      
      <category name="Motion" colour="#3399ff">
        <block type="set_position"></block>
        <block type="get_position"></block>
        <block type="movement_move_x"></block>
        <block type="movement_move_y"></block>
        <block type="goto_mouse"></block>
      </category>

      <category name="Style" colour="#cd17ff">
        <block type="change_costume"></block>
        <block type="next_costume"></block>
      </category>

      <category name="Sounds" colour="#c7b31c">
        <block type="play_sound"></block>
        <block type="play_sound_url"></block>
      </category>
        
      <category name="Loops" colour="#689c00">
        <block type="controls_repeat_ext">
          <value name="TIMES">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
        </block>
        <block type="controls_whileUntil">
          <field name="MODE">WHILE</field>
        </block>
        <block type="forever"></block>
        <block type="controls_for">
          <field name="VAR" id="QX?tv8_Oe7g@:yT:^:JX">i</field>
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM">10</field>
            </shadow>
          </value>
          <value name="BY">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
        <block type="controls_forEach">
          <field name="VAR" id="FegKP.X,(A|]G*?OeW.k">j</field>
        </block>
      </category>
      
      <category name="Math" colour="#1b85d1">
        <block type="math_number">
          <field name="NUM">0</field>
        </block>
        <block type="math_arithmetic">
          <field name="OP">ADD</field>
          <value name="A">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="B">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
        </block>
        <block type="math_single">
          <field name="OP">ROOT</field>
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">9</field>
            </shadow>
          </value>
        </block>
        <block type="math_trig">
          <field name="OP">SIN</field>
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">45</field>
            </shadow>
          </value>
        </block>
        <block type="math_constant">
          <field name="CONSTANT">PI</field>
        </block>
        <block type="math_number_property">
          <mutation divisor_input="false"></mutation>
          <field name="PROPERTY">EVEN</field>
          <value name="NUMBER_TO_CHECK">
            <shadow type="math_number">
              <field name="NUM">0</field>
            </shadow>
          </value>
        </block>
        <block type="math_round">
          <field name="OP">ROUND</field>
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">3.1</field>
            </shadow>
          </value>
        </block>
        <block type="math_random_int">
          <value name="FROM">
            <shadow type="math_number">
              <field name="NUM">1</field>
            </shadow>
          </value>
          <value name="TO">
            <shadow type="math_number">
              <field name="NUM">100</field>
            </shadow>
          </value>
        </block>
        <block type="math_random_float"></block>
      </category>
      
      <category name="Text" colour="#21d9b7">
        <block type="text">
          <field name="TEXT"></field>
        </block>
        <block type="text_join">
          <mutation items="2"></mutation>
        </block>
        <block type="text_append">
          <field name="VAR" id="sWNeB!rGsnM6B`o?Oy:I">item</field>
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT"></field>
            </shadow>
          </value>
        </block>
        <block type="text_isEmpty">
          <value name="VALUE">
            <shadow type="text">
              <field name="TEXT"></field>
            </shadow>
          </value>
        </block>
        <block type="text_indexOf">
          <field name="END">FIRST</field>
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" id="HlDf|hFCk#=p}+JmzR2+">text</field>
            </block>
          </value>
          <value name="FIND">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_changeCase">
          <field name="CASE">UPPERCASE</field>
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_print">
          <value name="TEXT">
            <shadow type="text">
              <field name="TEXT">abc</field>
            </shadow>
          </value>
        </block>
        <block type="text_prompt_ext">
      <mutation type="TEXT"></mutation>
      <field name="TYPE">TEXT</field>
      <value name="TEXT">
        <shadow type="text">
          <field name="TEXT">abc</field>
        </shadow>
      </value>
    </block>
        <block type="letters_from"></block>
      </category>
      
      <category name="Variables" colour="#f2951b" custom="VARIABLE"></category>
      
      <category name="Lists" colour="#f2461b">
        <block type="lists_create_with">
          <mutation items="0"></mutation>
        </block>
        <block type="lists_repeat">
          <value name="NUM">
            <shadow type="math_number">
              <field name="NUM">5</field>
            </shadow>
          </value>
        </block>
        <block type="lists_length"></block>
        <block type="lists_isEmpty"></block>
        <block type="lists_indexOf">
          <field name="END">FIRST</field>
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" id="}!Pr9@E_xu^L@{z[:5CY">list</field>
            </block>
          </value>
        </block>
        <block type="lists_getIndex">
          <mutation statement="false" at="true"></mutation>
          <field name="MODE">GET</field>
          <field name="WHERE">FROM_START</field>
          <value name="VALUE">
            <block type="variables_get">
              <field name="VAR" id="}!Pr9@E_xu^L@{z[:5CY">list</field>
            </block>
          </value>
        </block>
        <block type="lists_getSublist">
          <mutation at1="true" at2="true"></mutation>
          <field name="WHERE1">FROM_START</field>
          <field name="WHERE2">FROM_START</field>
          <value name="LIST">
            <block type="variables_get">
              <field name="VAR" id="}!Pr9@E_xu^L@{z[:5CY">list</field>
            </block>
          </value>
        </block>
      </category>

      <category name="Colour" colour="#a5745b"></category>

      <category name="Functions" custom="PROCEDURE" colour="#e643d2"></category>

      <!--
      <category name="Colours" custom="COLOUR_PALETTE" colour="#323aa8"></category>
      -->
      
      <category name="Other" colour="#a826ff">
        <block type="test_block"></block>
        <block type="custom_onstop"></block>
        <block type="bruh_wait"></block>
      </category>
    </xml>

<script src="/cates/custom.js"></script>
<script src="/cates/motion.js"></script>
<script src="/cates/styles.js"></script>
<script src="/cates/sounds.js"></script>
<script src="/cates/logic.js"></script>
<script src="/cates/control.js"></script>
<script src="/cates/functions.js"></script>
<script src="/cates/advanced.js"></script>

    <script>
      let costume = "https://bark.dumorando.com/src/images/dog/scratch_dog.png";
      let added = [];

      //handle hardcoded extensions
      Array.from(document.querySelectorAll("*")).forEach(item => {
        if (item.getAttribute("data-extensionpath")) {
          item.addEventListener("click", () => {
            if (!added.includes(item.getAttribute("data-extensionpath"))) {
              added.push(item.getAttribute("data-extensionpath"));
              fetch(item.getAttribute("data-extensionpath"))
              .then(data => data.text())
              .then(data => {
                eval(data);
              });
            }
          });
        }
      });

      function start() {
        window.workspace = Blockly.inject('blocklyDiv', {
          toolbox: document.getElementById('toolbox'),
          horizontalLayout: true,
          toolboxPosition: 'end',
          renderer: 'zelos',
        });

        workspace.addChangeListener(updateStage);

        workspace.registerButtonCallback("showExtsMenu", () => {
          document.querySelector(".popupholder").classList.add('active');
        });
      }

      function updateStage(event) {
        let code = Blockly.JavaScript.workspaceToCode(workspace);
        //document.getElementById('generated-code').textContent = code; // Display generated code
        //eval(code); // Evaluate generated code
      }

              
      javascript.javascriptGenerator.forBlock['onstart'] = function (block, generator) {
        return "alert('run button was clicked!');";
      };
      javascript.javascriptGenerator.forBlock['movement_move_x'] = function (block, generator) {
        return "basicMoveX(" + block.getFieldValue("NUM") + ");";
      };
      javascript.javascriptGenerator.forBlock['get_position'] = function (block, generator) {
        if (block.getFieldValue("XY") == "x") {
          return x;
        } else {
          return y;
        }
      };
       javascript.javascriptGenerator.forBlock['set_position'] = function (block, generator) {
        if (block.getFieldValue("XY") == "x") {
          return "moveto('x', " + (block.getFieldValue("NAME")) + ");";
        } else {
          return "moveto('y', " + (block.getFieldValue("NAME")) + ");";
        }
      };
      javascript.javascriptGenerator.forBlock['movement_move_y'] = function (block, generator) {
        return "basicMoveY(" + block.getFieldValue("NUM") + ");";
      };
      javascript.javascriptGenerator.forBlock['movement_moveback'] = function (block, generator) {
        return "basicMoveBack();";
      };
      

      javascript.javascriptGenerator.forBlock['goto_mouse'] = function (block, generator) {

        return "gotomouse();";
      };
      javascript.javascriptGenerator.forBlock['change_stage_bg'] = function (block, generator) {
        let colorValue = block.getFieldValue('NAME');
        return "changebg('" + colorValue + "');";
      };

      javascript.javascriptGenerator.forBlock['alert_block'] = function (block, generator) {
        let message = block.getFieldValue('message');
        return "alert('" + message + "');";
      };
      javascript.javascriptGenerator.forBlock['resetsize'] = function (block, generator) {
        let message = block.getFieldValue('message');
        return "resetsize();";
      };
      javascript.javascriptGenerator.forBlock['confirm_block'] = function (block, generator) {
        let message = block.getFieldValue('message');
        return "confirm('" + message + "');";
      };
      javascript.javascriptGenerator.forBlock['prompt_block'] = function (block, generator) {
        let message = block.getFieldValue('message');
        return "prompt('" + message + "');";
      };
      javascript.javascriptGenerator.forBlock['set_size'] = function (block, generator) {
        let message = Blockly.JavaScript.valueToCode(block, 'NAME', Blockly.JavaScript.ORDER_ATOMIC);
        return "setsize(Number('" + message + "'));";
      };
      javascript.javascriptGenerator.forBlock['change_size'] = function (block, generator) {
        let message = block.getFieldValue('message');
        return "setsize('imgWidth + " + message + "');";
      };

      javascript.javascriptGenerator.forBlock['fetch'] = function (block, generator) {
        let uri = block.getFieldValue('url');
        let handleFunction = generator.variableDB_.getDistinctName('handlefetch', Blockly.Variables.NAME_TYPE);
        generator.addFunction(handleFunction,
          `async function ${handleFunction}(url) {
              try {
                  const response = await fetch(url);
                  if (!response.ok) {
                      throw new Error('Network response was not ok');
                  }
                  const data = await response.json();
                  return data;
              } catch (error) {
                  console.error('Fetch error:', error);
                  return null;
              }
          }`);
        return `${handleFunction}('${uri}')`;
      };

            Blockly.Blocks['change_stage_bg'] = {
        init: function () {
          this.appendDummyInput()
            .appendField("Change stage background color to");
          this.appendDummyInput()
            .appendField(new Blockly.FieldColour("#ffffff"), "NAME");
          this.setPreviousStatement(true, null);
          this.setNextStatement(true, null);
          this.setColour(230);
          this.setTooltip("");
          this.setHelpUrl("");
        },

        // This function will be called whenever the block value changes
        onchange: function (event) {
          if (!this.workspace || this.workspace.isDragging() || event.type != Blockly.Events.BLOCK_CHANGE) {
            return;  // Don't change the stage while dragging blocks or on events other than block changes
          }
          if (event.blockId === this.id && event.name === "NAME") {
            let color = this.getFieldValue('NAME');
            // Call a JavaScript function in your p5.js sketch to change the background color
            changeBackgroundColor(color);
          }
        }
      };

    </script>



<!-- Big space for organization -->


    
    <script>
      /* @mnsderp for the data saving scripts */

      // Function to toggle dark mode
      function toggleDarkMode() {
        const body = document.body;
        body.classList.toggle('dark-mode');
        // Save dark mode state to local storage
        const isDarkMode = body.classList.contains('dark-mode');
        localStorage.setItem('darkMode', isDarkMode);
        initializeDarkMode();
      }

      // Function to initialize dark mode based on local storage
      

      // Attach event listener to dark mode toggle button
      const darkModeToggle = document.getElementById('darkModeToggle');
      darkModeToggle.addEventListener('click', toggleDarkMode);

      function openexternalproject() {
        window.showOpenFilePicker();
        alert("bark doesn't support uploading projects yet.");
      }

      function downloadproject() {
        let projectname = document.getElementById('projectname').value
        
        const state = Blockly.serialization.workspaces.save(workspace);
        const data = JSON.stringify({
          blockly: btoa(JSON.stringify(state)),
          costume,
          added
        });

        // Convert the XML text to Blob
        let blob = new Blob([data], { type: 'application/json' });

        // Create a link element
        let aElement = document.createElement('a');
        aElement.setAttribute('download', `${projectname}.barkf`);
        aElement.href = URL.createObjectURL(blob);
        aElement.setAttribute('target', '_blank');
        aElement.click();

        // Clean up
        URL.revokeObjectURL(aElement.href);
      }
      function openFileInput() {
        document.getElementById('fileInput').click();
      }

      function loadWorkspaceFromFile(file) {
        let reader = new FileReader();

        reader.onload = async function (event) {
          const data = JSON.parse(event.target.result);

          // Clear the workspace before loading
          Blockly.getMainWorkspace().clear();

          Blockly.serialization.workspaces.load(JSON.parse(atob(data.blockly)), workspace);
          loadImg(data.costume);

          document.getElementById("projectname").value = document.getElementById("fileInput").files[0].name.replaceAll("_", " ").replace(".barkf", "");

          // check if its there first to support older bark versions
          if (data.added) {
            for (const extURL of data.added) {
              if (!added.includes(extURL)) {
                const response = await fetch(extURL).then(data => data.text());
                eval(response);
                added.push(extURL);
              }
            }
          }
          
          //alert('Workspace loaded successfully!'); shut your happy ass up
        };

        reader.readAsText(file);
      }


      function run_code() {
        eval(Blockly.JavaScript.workspaceToCode(Blockly.getMainWorkspace()));
      }

      // Script from Stack Overflow
      let openFile = function (file) {
        let input = file.target;
        let reader = new FileReader();
        reader.onload = function () {
          let dataURL = reader.result;
          let output = document.getElementById('costume');
          loadImg(dataURL);
          costume = dataURL;
          output.src = dataURL;
        };
        reader.readAsDataURL(input.files[0]);
      };

      let openAudioFile = function (file) {
        let input = file.target.files[0];
        let reader = new FileReader();
        reader.onload = function () {
          let audio = new Audio();
          audio.src = URL.createObjectURL(input);
          audio.controls = true;
          document.getElementById("audiofilelist").append(audio);
        };
        reader.readAsDataURL(input);
      };

      const theme = localStorage.getItem('theme');
if (theme) {
    if (theme.startsWith('#')) {
        const style = document.createElement('style');
        document.head.append(style);
        const link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = `https://bark.dumorando.com//src/themes/bluedodger.css`;
        document.head.append(link);
    } else if (theme != "bluedodger") {
        const link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = `https://bark.dumorando.com//src/themes/${theme}.css`;
        document.head.append(link);
    } else {
        const link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = `https://bark.dumorando.com//src/themes/bluedodger.css`;
        document.head.append(link);
    }
} else {
        const link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = `https://bark.dumorando.com//src/themes/bluedodger.css`;
        document.head.append(link);
    }
    </script>
      <!-- do this before extension adding scripts -->
      <script src="/scripts/extensions.js"></script>
    <script>
      //import DarkTheme from 'https://esm.run/@blockly/theme-dark';

      //define it ourselves because this fuck ass script wont load it from esm.run
      const themedark = Blockly.Theme.defineTheme('dark', {
        base: Blockly.Themes.Classic,
        componentStyles: {
          workspaceBackgroundColour: '#1e1e1e',
          toolboxBackgroundColour: 'blackBackground',
          toolboxForegroundColour: '#fff',
          flyoutBackgroundColour: '#252526',
          flyoutForegroundColour: '#ccc',
          flyoutOpacity: 1,
          scrollbarColour: '#797979',
          insertionMarkerColour: '#fff',
          insertionMarkerOpacity: 0.3,
          scrollbarOpacity: 0.4,
          cursorColour: '#d0d0d0',
          blackBackground: '#333',
        },
      });

      function initializeDarkMode() {
        const isDarkMode = localStorage.getItem('darkMode') === 'true';
        const body = document.body;
        if (isDarkMode) {
          body.classList.add('dark-mode');
          console.log(window.workspace)
          // window.workspace.setTheme(themedark);
          // window.workspace.refreshTheme();
        } else {
          body.classList.remove('dark-mode');
          // window.workspace.setTheme();
          // window.workspace.refreshTheme();
        }
      }
      window.addEventListener('load', initializeDarkMode);

      function change_document_title() {
        if (document.getElementById("projectname").value != "project") {
          projectname = document.getElementById("projectname").value
          document.title = `${projectname} - Bark Coding`
        }
      }

    </script>

    <script>
      // scripts for extensions

       function fetchandexecute(url) {
        let file = url;
      fetch (file)
        .then(x => x.text())
        .then(y => eval(y));
      }

const extensions = [
  {
    "name": "Sine",
    "creator": "nmmsderp",
    "imgurl": "https://bark.dumorando.com/src/images/assets/extension/sine.png",
    "codeurl": "https://bark-editor.vercel.app/builtinextensions/sine.js",
    "count": 1,
  },
  {
    "name": "AI Chatbot",
    "creator": "funtasmo",
    "imgurl": "https://bark.dumorando.com/src/images/assets/extension/ai.png",
    "codeurl": "https://bark-editor.vercel.app/builtinextensions/ai.js",
    "count": 2,
  },
  {
    "name": "Discord Bot Maker",
    "creator": "mariocraft987",
    "imgurl": "https://bark.dumorando.com/src/images/assets/extension/discord.png",
    "codeurl": "https://bark-editor.vercel.app/builtinextensions/discord.js",
    "count": 3,
  },
  {
    "name": "BarkFetch",
    "creator": "mariocraft987",
    "imgurl": "https://bark.dumorando.com/src/images/assets/extension/barkfetch.png",
    "codeurl": "https://bark-editor.vercel.app/builtinextensions/barkfetch.js",
    "count": 4,
  },
  {
    "name": "Lua For Bark",
    "creator": "mariocraft987",
    "imgurl": "https://bark.dumorando.com/src/images/assets/extension/lua.png",
    "codeurl": "https://bark-editor.vercel.app/builtinextensions/lua.js",
    "count": 5,
  }
];
      
    for (const data of extensions) {

        document.getElementById("moreextensionseditordiv").innerHTML += 
      `
      <span style="width:280px" class="extensionbox" onclick="setTimeout(fetchandexecute('${data.codeurl}'), 500);">
        ${data.name}
        <br/>
        <div><img src="${data.imgurl}" width="140" alt="Thumbnail of ${data.name}" title="${data.name}, made by ${data.creator}"></div>
        <br/>
        Made by ${data.creator}
      </span>
      `;
    }

      
    </script>
    
  <script src="/scripts/custom.js"></script>
  <script src="/scripts/contrast.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="/scripts/demo_projects.js"></script>
  <script src="/scripts/fullscreen.js"></script>
  <script>
    console.log("All editor scripts were ran successfully!");
  </script> 
    
</body>
</html>
